<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - ETIMO</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M50,5 C60,20 80,30 85,50 C90,70 75,85 50,95 C25,85 10,70 15,50 C20,30 40,20 50,5Z' fill='%232e7d32'/></svg>">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f4f7f4 0%, #e8f4e8 100%);
            color: #333;
            min-height: 100vh;
            padding-bottom: 40px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            padding: 30px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 30px;
            border: 3px solid #2E8B57;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .logo {
            height: 100px;
            width: auto;
            background: white;
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 3px solid #1F7A3E;
        }

        .header-text {
            flex: 1;
        }

        h1 {
            font-size: 36px;
            margin-bottom: 10px;
            color: #1F7A3E;
            font-weight: 800;
        }

        .subtitle {
            font-size: 18px;
            color: #666;
            font-weight: 500;
        }

        .empresa-info {
            background: #f8fff8;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #2E8B57;
            text-align: right;
        }

        .empresa-nombre {
            font-size: 24px;
            font-weight: 700;
            color: #1F7A3E;
            margin-bottom: 10px;
        }

        .nivel-actual {
            font-size: 18px;
            color: #2e7d32;
            font-weight: 600;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .kpi-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            text-align: center;
            border-top: 6px solid #1F7A3E;
            transition: all 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.12);
        }

        .kpi-icon {
            font-size: 35px;
            margin-bottom: 15px;
        }

        .kpi-card h3 {
            color: #124d2d;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .kpi-value {
            font-size: 40px;
            font-weight: 800;
            color: #1F7A3E;
            margin-bottom: 5px;
            line-height: 1;
        }

        .kpi-unit {
            color: #666;
            font-size: 14px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 18px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            border: 1px solid #e8f4e8;
        }

        .chart-container h2 {
            color: #124d2d;
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: 700;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .ods-section {
            background: white;
            padding: 30px;
            border-radius: 18px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            margin-bottom: 40px;
            border: 1px solid #e8f4e8;
        }

        .ods-section h2 {
            color: #124d2d;
            margin-bottom: 25px;
            font-size: 24px;
            font-weight: 700;
            text-align: center;
        }

        .ods-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .ods-container span {
            display: inline-block;
            padding: 10px 20px;
            background: #1F7A3E;
            color: white;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: help;
            transition: all 0.3s;
        }

        .ods-container span:hover {
            transform: scale(1.1);
            background: #155b2a;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .footer {
            text-align: center;
            color: #888;
            font-size: 14px;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid #ddd;
        }
        
        /* Nuevos estilos para filtros */
        .filtro-activo {
            background: #2E8B5720;
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #2E8B57;
            margin-bottom: 25px;
            font-size: 16px;
        }
        
        .metrica-general:hover, .metrica-sector:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1) !important;
        }
        
        .btn-filtro {
            padding: 12px 24px;
            background: #2E8B57;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-filtro:hover {
            background: #2E8B57dd;
            transform: translateY(-2px);
        }
        
        .btn-reset {
            padding: 12px 24px;
            background: #f8f9fa;
            color: #666;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-reset:hover {
            background: #e9ecef;
            border-color: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <img class="logo"
                     src="https://res.cloudinary.com/ddubafael/image/upload/v1768315140/logo_institucional_final_tranp._impacta_verde_ec55yo.png"
                     alt="Impacta Verde">
                <div class="header-text">
                    <h1>üìä Dashboard de Sostenibilidad por Empresa</h1>
                    <div class="subtitle">Seguimiento del impacto ambiental y social - Sistema Impacta Verde</div>
                </div>
            </div>
            <div class="empresa-info">
                <div class="empresa-nombre">ETIMO</div>
                <div class="nivel-actual">
                    ‚ôªÔ∏è Sector: Reciclaje | üåø Nivel Actual: Inicial
                </div>
                <div style="font-size: 14px; color: #888; margin-top: 10px;">
                    Actualizado: 06/02/2026
                </div>
            </div>
        </header>

        <!-- KPI PRINCIPALES -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-icon">üìà</div>
                <h3>Tendencia de Evoluci√≥n</h3>
                <div class="kpi-value">-0.08</div>
                <div class="kpi-unit">puntos/mes</div>
                <div style="font-size: 12px; color: #666; margin-top: 5px;">‚ÜòÔ∏è -0.08 puntos/mes</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-icon">üåç</div>
                <h3>CO‚ÇÇe Evitado</h3>
                <div class="kpi-value">2.9</div>
                <div class="kpi-unit">toneladas totales</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-icon">‚ôªÔ∏è</div>
                <h3>Material Recuperado</h3>
                <div class="kpi-value">1.2</div>
                <div class="kpi-unit">toneladas totales</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-icon">‚≠ê</div>
                <h3>Impacto Promedio</h3>
                <div class="kpi-value">39.3%</div>
                <div class="kpi-unit">de sostenibilidad</div>
            </div>
        </div>

        <!-- FILTRO POR FECHAS -->
        
            <div style="margin: 20px 0; padding: 25px; background: #D4EDDA30; border-radius: 15px; border: 3px solid #2E8B57; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
                <h3 style="color: #2E8B57; margin-top: 0; margin-bottom: 20px; font-size: 20px; display: flex; align-items: center; gap: 10px;">
                    üìÖ FILTRO POR FECHAS (APLICABLE A TODO EL DASHBOARD)
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #124d2d;">üóìÔ∏è Seleccionar Per√≠odo:</label>
                        <select id="periodoSelector" style="width: 100%; padding: 14px; border: 2px solid #2E8B57; border-radius: 10px; font-size: 16px; background: white; color: #124d2d;">
                            <option value="todos">üìä TODOS LOS MESES (Valores Acumulados)</option>
                            <option value="0" >Ene 2025</option><option value="1" >Feb 2025</option><option value="2" >Mar 2025</option><option value="3" >Abr 2025</option><option value="4" >May 2025</option><option value="5" >Jun 2025</option><option value="6" >Jul 2025</option><option value="7" >Ago 2025</option><option value="8" >Sep 2025</option><option value="9" >Oct 2025</option><option value="10" >Nov 2025</option><option value="11" selected>Dic 2025</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #124d2d;">üìà Tipo de Visualizaci√≥n:</label>
                        <select id="tipoVista" style="width: 100%; padding: 14px; border: 2px solid #2E8B57; border-radius: 10px; font-size: 16px; background: white; color: #124d2d;">
                            <option value="acumulado">üìà Valores Acumulados</option>
                            <option value="mensual">üìÖ Valores Mensuales</option>
                            <option value="porcentaje">üìä Porcentajes y Tendencias</option>
                        </select>
                    </div>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 15px;">
                    <button id="aplicarFiltro" style="padding: 14px 28px; background: #2E8B57; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px;">
                        üîÑ APLICAR FILTRO
                    </button>
                    <button id="resetFiltro" style="padding: 14px 28px; background: #f8f9fa; color: #666; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                        üóëÔ∏è RESTABLECER
                    </button>
                </div>
                <p style="margin-top: 20px; color: #666; font-size: 14px; font-style: italic;">
                    <strong>üí° Nota:</strong> Este filtro afecta todas las m√©tricas y gr√°ficos del dashboard.
                    Selecciona un mes espec√≠fico para ver los valores de ese per√≠odo, 
                    o elige "Todos los meses" para ver los valores acumulados totales.
                </p>
            </div>
            
        
        <!-- INDICADOR DE FILTRO ACTIVO -->
        
        <div id="indicadorFiltro" style="display: none; margin: 15px 0; padding: 15px; background: #e8f5e9; border-radius: 10px; border-left: 5px solid #2e7d32;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 18px;">‚úÖ</span>
                <div>
                    <strong>Filtro activo:</strong> Mostrando datos para 
                    <span id="periodoSeleccionado" style="font-weight: 700; color: #1F7A3E;"></span> | 
                    Tipo de vista: <span id="tipoVistaSeleccionado" style="font-weight: 700; color: #1F7A3E;"></span>
                </div>
            </div>
        </div>
        

        <!-- M√âTRICAS DEL SECTOR -->
        
                <div style="margin: 40px 0; padding: 30px; background: #D4EDDA30; border-radius: 15px; border: 3px solid #2E8B57; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
                    <h3 style="color: #2E8B57; margin-top: 0; margin-bottom: 25px; font-size: 22px; display: flex; align-items: center; gap: 10px; border-bottom: 2px solid #2E8B5750; padding-bottom: 15px;">
                        ‚ôªÔ∏è M√âTRICAS ESPEC√çFICAS DEL SECTOR - RECICLAJE
                    </h3>
                    <p style="color: #666; margin-bottom: 20px; font-size: 15px;">
                        M√©tricas espec√≠ficas para el sector Reciclaje. 
                        <strong>Usa el filtro de fechas para ver valores por mes espec√≠fico o acumulados.</strong>
                    </p>

                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; margin-top: 20px;" id="gridMetricasSector">
                        
                        <div class="metrica-sector" data-tipo="acumulado">
                            <div style="background: #f8f9fa; padding: 22px; border-radius: 12px; border-left: 5px solid #ccc; box-shadow: 0 4px 12px rgba(0,0,0,0.04); height: 100%;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <div style="font-size: 15px; color: #888; font-weight: 700;">üç∂ Vidrio reciclado</div>
                                    <div style="font-size: 12px; color: #bbb; background: #eee; padding: 4px 10px; border-radius: 20px;">acumulado</div>
                                </div>
                                <div style="font-size: 18px; font-weight: 600; color: #999; margin-bottom: 8px;">A√∫n no implementado</div>
                                <div style="font-size: 15px; color: #bbb;">kg</div>
                                <div style="font-size: 13px; color: #ccc; margin-top: 10px; font-style: italic; border-top: 1px solid #eee; padding-top: 8px;">Vidrio recuperado acumulado</div>
                            </div>
                        </div>
                        
                        <div class="metrica-sector" data-tipo="acumulado">
                            <div style="background: #f8f9fa; padding: 22px; border-radius: 12px; border-left: 5px solid #ccc; box-shadow: 0 4px 12px rgba(0,0,0,0.04); height: 100%;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <div style="font-size: 15px; color: #888; font-weight: 700;">üîÑ Pl√°stico recuperado</div>
                                    <div style="font-size: 12px; color: #bbb; background: #eee; padding: 4px 10px; border-radius: 20px;">acumulado</div>
                                </div>
                                <div style="font-size: 18px; font-weight: 600; color: #999; margin-bottom: 8px;">A√∫n no implementado</div>
                                <div style="font-size: 15px; color: #bbb;">kg</div>
                                <div style="font-size: 13px; color: #ccc; margin-top: 10px; font-style: italic; border-top: 1px solid #eee; padding-top: 8px;">Pl√°stico recuperado acumulado</div>
                            </div>
                        </div>
                        
                        <div class="metrica-sector" data-tipo="porcentaje">
                            <div style="background: #f8f9fa; padding: 22px; border-radius: 12px; border-left: 5px solid #ccc; box-shadow: 0 4px 12px rgba(0,0,0,0.04); height: 100%;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <div style="font-size: 15px; color: #888; font-weight: 700;">üìä % Tasa de recuperaci√≥n</div>
                                    <div style="font-size: 12px; color: #bbb; background: #eee; padding: 4px 10px; border-radius: 20px;">porcentaje</div>
                                </div>
                                <div style="font-size: 18px; font-weight: 600; color: #999; margin-bottom: 8px;">A√∫n no implementado</div>
                                <div style="font-size: 15px; color: #bbb;">%</div>
                                <div style="font-size: 13px; color: #ccc; margin-top: 10px; font-style: italic; border-top: 1px solid #eee; padding-top: 8px;">Porcentaje de materiales recuperados</div>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
        
        <!-- M√âTRICAS GENERALES -->
        
        
        <!-- M√âTRICAS SOCIALES -->
        

        <!-- GR√ÅFICOS PRINCIPALES -->
        
        <div class="charts-grid">
            <div class="chart-container">
                <h2>üìà Evoluci√≥n de CO‚ÇÇe Evitado (kg)</h2>
                <div class="chart-wrapper">
                    <canvas id="chartCO2"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h2>üìä Evoluci√≥n del Impacto de Sostenibilidad (%)</h2>
                <div class="chart-wrapper">
                    <canvas id="chartPuntaje"></canvas>
                </div>
            </div>
        </div>
        

        <!-- GR√ÅFICOS DE ENERG√çA -->
        

        <!-- GR√ÅFICOS DE HUELLA H√çDRICA Y COMBUSTIBLE -->
        

        <!-- GR√ÅFICOS SECTOR ESPEC√çFICOS -->
        

        <!-- GR√ÅFICO DE DESPERDICIO POR PLATO (PARA SECTORES ALIMENTICIOS) -->
        

        <!-- GR√ÅFICO DE MATERIALES -->
        

        <!-- CONTRIBUCI√ìN A LOS ODS -->
        <div class="ods-section">
            <h2>üåç Contribuci√≥n a los Objetivos de Desarrollo Sostenible</h2>
            <div class="ods-container">
                <span title="Fin de la pobreza">1</span><span title="Igualdad de g√©nero">5</span><span title="Energ√≠a asequible y no contaminante">7</span><span title="Trabajo decente y crecimiento econ√≥mico">8</span><span title="Industria, innovaci√≥n e infraestructura">9</span><span title="Reducci√≥n de las desigualdades">10</span><span title="Producci√≥n y consumo responsables">12</span><span title="Acci√≥n por el clima">13</span><span title="Vida de ecosistemas terrestres">15</span><span title="Alianzas para lograr los objetivos">17</span>
            </div>
            <p style="text-align:center; font-size:14px; color:#666; margin-top:20px; font-style:italic;">
                Pasa el cursor sobre cada n√∫mero para ver el objetivo completo
            </p>
        </div>

        
        <div class="footer">
            <p>üìä Dashboard individual de ETIMO</p>
            <p>üåø Sistema Impacta Verde - Mediciones de sostenibilidad</p>
            <p style="font-size: 12px; color: #888; margin-top: 10px;">
                Actualizado: 06/02/2026 15:44
            </p>
        </div>
        
    </div>

    
    <script>
        // Datos para gr√°ficos y filtro
        const mesesLabels = ["Ene 2025", "Feb 2025", "Mar 2025", "Abr 2025", "May 2025", "Jun 2025", "Jul 2025", "Ago 2025", "Sep 2025", "Oct 2025", "Nov 2025", "Dic 2025"];
        const co2Data = [262.26, 258.49, 254.56, 250.78, 246.86, 243.09, 239.16, 235.39, 231.46, 227.69, 223.76, 219.99];
        const puntajeData = [39.8, 39.7, 39.6, 39.5, 39.5, 39.4, 39.3, 39.2, 39.1, 39.0, 38.9, 38.9];
        const energiaTotalData = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];
        const porcentajeSolarData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        const huellaHidricaData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        const combustibleData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        const proveedoresData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        const reusoData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        const desperdicioPlatoData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        const materialesLabels = ["Papel", "Pl\u00e1stico", "Tela", "Tecnolog\u00eda", "Borra seca", "Borra h\u00fameda", "Vidrio", "Biodegradables"];
        const materialesData = [0, 0, 0, 0, 0, 0, 0, 0];
        const materialesAcumulados = [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]];
        
        // Datos mensuales completos para filtrado
        const datosMensuales = [{"mes": "Ene", "a\u00f1o": "2025", "energia_total": 0.0, "energia_solar": 0.0, "combustible": 0.0, "papel": 0.0, "huella_hidrica": 0.0, "borra_humeda": 0.0, "borra_seca": 0.0, "tela": 0.0, "tecnologia": 0.0, "plastico": 0.0, "biodegradables": 0.0, "vidrio": 0.0, "residuo_organico": 0.0, "residuo_reciclable": 0.0, "residuo_no_reciclable": 0.0}, {"mes": "Feb", "a\u00f1o": "2025", "energia_total": 0.0, "energia_solar": 0.0, "combustible": 0.0, "papel": 0.0, "huella_hidrica": 0.0, "borra_humeda": 0.0, "borra_seca": 0.0, "tela": 0.0, "tecnologia": 0.0, "plastico": 0.0, "biodegradables": 0.0, "vidrio": 0.0, "residuo_organico": 0.0, "residuo_reciclable": 0.0, "residuo_no_reciclable": 0.0}, {"mes": "Mar", "a\u00f1o": "2025", "energia_total": 0.0, "energia_solar": 0.0, "combustible": 0.0, "papel": 0.0, "huella_hidrica": 0.0, "borra_humeda": 0.0, "borra_seca": 0.0, "tela": 0.0, "tecnologia": 0.0, "plastico": 0.0, "biodegradables": 0.0, "vidrio": 0.0, "residuo_organico": 0.0, "residuo_reciclable": 0.0, "residuo_no_reciclable": 0.0}, {"mes": "Abr", "a\u00f1o": "2025", "energia_total": 0.0, "energia_solar": 0.0, "combustible": 0.0, "papel": 0.0, "huella_hidrica": 0.0, "borra_humeda": 0.0, "borra_seca": 0.0, "tela": 0.0, "tecnologia": 0.0, "plastico": 0.0, "biodegradables": 0.0, "vidrio": 0.0, "residuo_organico": 0.0, "residuo_reciclable": 0.0, "residuo_no_reciclable": 0.0}, {"mes": "May", "a\u00f1o": "2025", "energia_total": 0.0, "energia_solar": 0.0, "combustible": 0.0, "papel": 0.0, "huella_hidrica": 0.0, "borra_humeda": 0.0, "borra_seca": 0.0, "tela": 0.0, "tecnologia": 0.0, "plastico": 0.0, "biodegradables": 0.0, "vidrio": 0.0, "residuo_organico": 0.0, "residuo_reciclable": 0.0, "residuo_no_reciclable": 0.0}, {"mes": "Jun", "a\u00f1o": "2025", "energia_total": 0.0, "energia_solar": 0.0, "combustible": 0.0, "papel": 0.0, "huella_hidrica": 0.0, "borra_humeda": 0.0, "borra_seca": 0.0, "tela": 0.0, "tecnologia": 0.0, "plastico": 0.0, "biodegradables": 0.0, "vidrio": 0.0, "residuo_organico": 0.0, "residuo_reciclable": 0.0, "residuo_no_reciclable": 0.0}, {"mes": "Jul", "a\u00f1o": "2025", "energia_total": 0.0, "energia_solar": 0.0, "combustible": 0.0, "papel": 0.0, "huella_hidrica": 0.0, "borra_humeda": 0.0, "borra_seca": 0.0, "tela": 0.0, "tecnologia": 0.0, "plastico": 0.0, "biodegradables": 0.0, "vidrio": 0.0, "residuo_organico": 0.0, "residuo_reciclable": 0.0, "residuo_no_reciclable": 0.0}, {"mes": "Ago", "a\u00f1o": "2025", "energia_total": 0.0, "energia_solar": 0.0, "combustible": 0.0, "papel": 0.0, "huella_hidrica": 0.0, "borra_humeda": 0.0, "borra_seca": 0.0, "tela": 0.0, "tecnologia": 0.0, "plastico": 0.0, "biodegradables": 0.0, "vidrio": 0.0, "residuo_organico": 0.0, "residuo_reciclable": 0.0, "residuo_no_reciclable": 0.0}, {"mes": "Sep", "a\u00f1o": "2025", "energia_total": 0.0, "energia_solar": 0.0, "combustible": 0.0, "papel": 0.0, "huella_hidrica": 0.0, "borra_humeda": 0.0, "borra_seca": 0.0, "tela": 0.0, "tecnologia": 0.0, "plastico": 0.0, "biodegradables": 0.0, "vidrio": 0.0, "residuo_organico": 0.0, "residuo_reciclable": 0.0, "residuo_no_reciclable": 0.0}, {"mes": "Oct", "a\u00f1o": "2025", "energia_total": 0.0, "energia_solar": 0.0, "combustible": 0.0, "papel": 0.0, "huella_hidrica": 0.0, "borra_humeda": 0.0, "borra_seca": 0.0, "tela": 0.0, "tecnologia": 0.0, "plastico": 0.0, "biodegradables": 0.0, "vidrio": 0.0, "residuo_organico": 0.0, "residuo_reciclable": 0.0, "residuo_no_reciclable": 0.0}, {"mes": "Nov", "a\u00f1o": "2025", "energia_total": 0.0, "energia_solar": 0.0, "combustible": 0.0, "papel": 0.0, "huella_hidrica": 0.0, "borra_humeda": 0.0, "borra_seca": 0.0, "tela": 0.0, "tecnologia": 0.0, "plastico": 0.0, "biodegradables": 0.0, "vidrio": 0.0, "residuo_organico": 0.0, "residuo_reciclable": 0.0, "residuo_no_reciclable": 0.0}, {"mes": "Dic", "a\u00f1o": "2025", "energia_total": 0.0, "energia_solar": 0.0, "combustible": 0.0, "papel": 0.0, "huella_hidrica": 0.0, "borra_humeda": 0.0, "borra_seca": 0.0, "tela": 0.0, "tecnologia": 0.0, "plastico": 0.0, "biodegradables": 0.0, "vidrio": 0.0, "residuo_organico": 0.0, "residuo_reciclable": 0.0, "residuo_no_reciclable": 0.0}];
        
        // Variables para almacenar datos filtrados
        let periodoSeleccionado = 'todos';
        let tipoVistaSeleccionado = 'acumulado';
        
        // Funci√≥n para formatear n√∫meros
        function formatearNumero(numero) {
            if (typeof numero !== 'number') return numero;
            if (numero >= 1000) {
                return (numero / 1000).toFixed(2) + 'k';
            }
            return numero.toFixed(2);
        }
        
        // Funci√≥n para actualizar el indicador de filtro
        function actualizarIndicadorFiltro() {
            const indicador = document.getElementById('indicadorFiltro');
            const periodoSpan = document.getElementById('periodoSeleccionado');
            const tipoSpan = document.getElementById('tipoVistaSeleccionado');
            
            if (periodoSeleccionado === 'todos') {
                periodoSpan.textContent = 'Todos los meses (Acumulado)';
                indicador.style.display = 'none';
            } else {
                const periodoNombre = mesesLabels[parseInt(periodoSeleccionado)];
                periodoSpan.textContent = periodoNombre;
                
                const tiposVista = {
                    'acumulado': 'Valores Acumulados',
                    'mensual': 'Valores Mensuales',
                    'porcentaje': 'Porcentajes'
                };
                tipoSpan.textContent = tiposVista[tipoVistaSeleccionado];
                indicador.style.display = 'block';
            }
        }
        
        // Funci√≥n para calcular valores acumulados hasta un mes espec√≠fico
        function calcularAcumuladoHastaMes(indiceMes) {
            const acumulados = {};
            
            // Inicializar acumulados
            const metricas = ['energia_total', 'energia_solar', 'combustible', 'papel', 
                            'huella_hidrica', 'borra_humeda', 'borra_seca', 'tela', 
                            'tecnologia', 'plastico', 'biodegradables', 'vidrio',
                            'residuo_organico', 'residuo_reciclable', 'residuo_no_reciclable'];
            
            metricas.forEach(metrica => {
                acumulados[metrica] = 0;
            });
            
            // Acumular hasta el mes seleccionado
            for (let i = 0; i <= indiceMes; i++) {
                metricas.forEach(metrica => {
                    if (datosMensuales[i] && datosMensuales[i][metrica]) {
                        acumulados[metrica] += datosMensuales[i][metrica];
                    }
                });
            }
            
            // Calcular porcentajes
            if (acumulados.energia_total > 0) {
                acumulados.porcentaje_energia_solar = (acumulados.energia_solar / acumulados.energia_total) * 100;
            } else {
                acumulados.porcentaje_energia_solar = 0;
            }
            
            const total_residuos = acumulados.residuo_organico + acumulados.residuo_reciclable + acumulados.residuo_no_reciclable;
            if (total_residuos > 0) {
                acumulados.tasa_reciclaje = (acumulados.residuo_reciclable / total_residuos) * 100;
            } else {
                acumulados.tasa_reciclaje = 0;
            }
            
            return acumulados;
        }
        
        // Funci√≥n para actualizar las m√©tricas en la p√°gina
        function actualizarMetricas() {
            let datosFiltrados;
            
            if (periodoSeleccionado === 'todos') {
                // Calcular acumulados totales
                datosFiltrados = calcularAcumuladoHastaMes(datosMensuales.length - 1);
            } else {
                const indiceMes = parseInt(periodoSeleccionado);
                
                if (tipoVistaSeleccionado === 'acumulado') {
                    // Acumulado hasta el mes seleccionado
                    datosFiltrados = calcularAcumuladoHastaMes(indiceMes);
                } else {
                    // Solo el mes seleccionado
                    datosFiltrados = datosMensuales[indiceMes] || {};
                    
                    // Calcular porcentajes para el mes
                    if (datosFiltrados.energia_total > 0) {
                        datosFiltrados.porcentaje_energia_solar = (datosFiltrados.energia_solar / datosFiltrados.energia_total) * 100;
                    } else {
                        datosFiltrados.porcentaje_energia_solar = 0;
                    }
                    
                    const total_residuos = (datosFiltrados.residuo_organico || 0) + 
                                         (datosFiltrados.residuo_reciclable || 0) + 
                                         (datosFiltrados.residuo_no_reciclable || 0);
                    if (total_residuos > 0) {
                        datosFiltrados.tasa_reciclaje = ((datosFiltrados.residuo_reciclable || 0) / total_residuos) * 100;
                    } else {
                        datosFiltrados.tasa_reciclaje = 0;
                    }
                }
            }
            
            // Mapeo de claves de m√©tricas
            const mapeoMetricas = {
                'energia_total_kwh': 'energia_total',
                'energia_solar_kwh': 'energia_solar',
                'porcentaje_energia_solar': 'porcentaje_energia_solar',
                'combustible_estacionario_l': 'combustible',
                'papel_kg': 'papel',
                'huella_hidrica_m3': 'huella_hidrica',
                'borra_humeda_kg': 'borra_humeda',
                'borra_seca_kg': 'borra_seca',
                'tela_reutilizada_kg': 'tela',
                'tecnologia_recuperada_kg': 'tecnologia',
                'plastico_reutilizado_kg': 'plastico',
                'materiales_biodegradables_kg': 'biodegradables',
                'vidrio_reciclado_kg': 'vidrio',
                'residuo_organico_kg': 'residuo_organico',
                'residuo_reciclable_kg': 'residuo_reciclable',
                'residuo_no_reciclable_kg': 'residuo_no_reciclable',
                'tasa_reciclaje_total': 'tasa_reciclaje'
            };
            
            // Actualizar m√©tricas generales
            const metricasGenerales = document.querySelectorAll('#gridMetricasGenerales .metrica-general');
            
            metricasGenerales.forEach(metrica => {
                const clave = metrica.getAttribute('data-clave');
                const claveDatos = mapeoMetricas[clave];
                const valorElement = metrica.querySelector('.valor-metrica');
                
                if (claveDatos && datosFiltrados[claveDatos] !== undefined) {
                    let valor = datosFiltrados[claveDatos];
                    
                    // Formatear seg√∫n el tipo de m√©trica
                    if (clave.includes('porcentaje') || clave.includes('tasa')) {
                        valorElement.textContent = valor.toFixed(2) + '%';
                    } else if (valor >= 1000) {
                        valorElement.textContent = (valor / 1000).toFixed(2) + 'k';
                    } else {
                        valorElement.textContent = valor.toFixed(2);
                    }
                    
                    // Cambiar estilo si hay datos
                    metrica.querySelector('div').style.borderLeftColor = '#1F7A3E';
                    metrica.querySelector('div').style.background = 'white';
                } else {
                    // No hay datos para este per√≠odo
                    valorElement.textContent = 'A√∫n no implementado';
                    metrica.querySelector('div').style.borderLeftColor = '#ccc';
                    metrica.querySelector('div').style.background = '#f8f9fa';
                }
            });
            
            // Actualizar indicador de filtro
            actualizarIndicadorFiltro();
            
            // Actualizar gr√°ficos si es necesario
            actualizarGraficos();
        }
        
        // Funci√≥n para actualizar gr√°ficos seg√∫n el filtro
        function actualizarGraficos() {
            // Esta funci√≥n puede ser extendida para actualizar gr√°ficos din√°micamente
            console.log('Filtro aplicado: Per√≠odo =', periodoSeleccionado, 'Tipo =', tipoVistaSeleccionado);
        }
        
        // Inicializar gr√°ficos
        function inicializarGraficos() {
            // Gr√°fico de CO‚ÇÇ
            if (document.getElementById('chartCO2') && co2Data.length > 0) {
                const ctx1 = document.getElementById('chartCO2').getContext('2d');
                new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: mesesLabels,
                        datasets: [{
                            label: 'CO‚ÇÇe Evitado (kg)',
                            data: co2Data,
                            borderColor: '#1F7A3E',
                            backgroundColor: 'rgba(31, 122, 62, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#1F7A3E',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Kilogramos de CO‚ÇÇe'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Per√≠odo'
                                }
                            }
                        }
                    }
                });
            }
            
            // Gr√°fico de puntaje
            if (document.getElementById('chartPuntaje') && puntajeData.length > 0) {
                const ctx2 = document.getElementById('chartPuntaje').getContext('2d');
                new Chart(ctx2, {
                    type: 'line',
                    data: {
                        labels: mesesLabels,
                        datasets: [{
                            label: 'Impacto de Sostenibilidad (%)',
                            data: puntajeData,
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#2ecc71',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Impacto (%)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Gr√°fico de energ√≠a total
            if (document.getElementById('chartEnergiaTotal') && energiaTotalData.length > 0) {
                const ctx3 = document.getElementById('chartEnergiaTotal').getContext('2d');
                new Chart(ctx3, {
                    type: 'bar',
                    data: {
                        labels: mesesLabels,
                        datasets: [{
                            label: 'Energ√≠a Total (kWh)',
                            data: energiaTotalData,
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            borderColor: '#2980b9',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Kilovatios-hora (kWh)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Gr√°fico de energ√≠a solar
            if (document.getElementById('chartEnergiaSolar') && porcentajeSolarData.length > 0) {
                const ctx4 = document.getElementById('chartEnergiaSolar').getContext('2d');
                new Chart(ctx4, {
                    type: 'line',
                    data: {
                        labels: mesesLabels,
                        datasets: [{
                            label: '% Energ√≠a Fotovoltaica',
                            data: porcentajeSolarData,
                            borderColor: '#f39c12',
                            backgroundColor: 'rgba(243, 156, 18, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#f39c12',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Porcentaje (%)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Gr√°fico de huella h√≠drica
            if (document.getElementById('chartHuellaHidrica') && huellaHidricaData.length > 0) {
                const ctx5 = document.getElementById('chartHuellaHidrica').getContext('2d');
                new Chart(ctx5, {
                    type: 'bar',
                    data: {
                        labels: mesesLabels,
                        datasets: [{
                            label: 'Huella H√≠drica (m¬≥)',
                            data: huellaHidricaData,
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            borderColor: '#2980b9',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Metros c√∫bicos (m¬≥)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Gr√°fico de combustible
            if (document.getElementById('chartCombustible') && combustibleData.length > 0) {
                const ctx6 = document.getElementById('chartCombustible').getContext('2d');
                new Chart(ctx6, {
                    type: 'bar',
                    data: {
                        labels: mesesLabels,
                        datasets: [{
                            label: 'Combustible Estacionario (L)',
                            data: combustibleData,
                            backgroundColor: 'rgba(231, 76, 60, 0.7)',
                            borderColor: '#c0392b',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Litros (L)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Gr√°fico de proveedores locales
            if (document.getElementById('chartProveedores') && proveedoresData.length > 0) {
                const ctx7 = document.getElementById('chartProveedores').getContext('2d');
                new Chart(ctx7, {
                    type: 'line',
                    data: {
                        labels: mesesLabels,
                        datasets: [{
                            label: '% Proveedores Locales',
                            data: proveedoresData,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#3498db',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Porcentaje (%)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Gr√°fico de reuso
            if (document.getElementById('chartReuso') && reusoData.length > 0) {
                const ctx8 = document.getElementById('chartReuso').getContext('2d');
                new Chart(ctx8, {
                    type: 'line',
                    data: {
                        labels: mesesLabels,
                        datasets: [{
                            label: '% Participaci√≥n en Reuso',
                            data: reusoData,
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#9b59b6',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Porcentaje (%)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Gr√°fico de desperdicio por plato
            if (document.getElementById('chartDesperdicio') && desperdicioPlatoData.length > 0) {
                const ctx9 = document.getElementById('chartDesperdicio').getContext('2d');
                new Chart(ctx9, {
                    type: 'line',
                    data: {
                        labels: mesesLabels,
                        datasets: [{
                            label: 'Desperdicio por Plato (g)',
                            data: desperdicioPlatoData,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#e74c3c',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Gramos (g)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Gr√°fico de materiales
            if (document.getElementById('chartMateriales') && materialesData.length > 0) {
                const ctx10 = document.getElementById('chartMateriales').getContext('2d');
                new Chart(ctx10, {
                    type: 'bar',
                    data: {
                        labels: materialesLabels,
                        datasets: [{
                            label: 'Materiales Recuperados (kg)',
                            data: materialesData,
                            backgroundColor: [
                                '#1F7A3E',
                                '#2ecc71',
                                '#3498db',
                                '#9b59b6',
                                '#e74c3c',
                                '#f39c12',
                                '#1abc9c',
                                '#16a085'
                            ],
                            borderColor: '#124d2d',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Kilogramos (kg)'
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Configurar eventos del filtro
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar gr√°ficos
            inicializarGraficos();
            
            // Configurar bot√≥n de aplicar filtro
            const aplicarFiltroBtn = document.getElementById('aplicarFiltro');
            const resetFiltroBtn = document.getElementById('resetFiltro');
            const periodoSelector = document.getElementById('periodoSelector');
            const tipoVistaSelector = document.getElementById('tipoVista');
            
            if (aplicarFiltroBtn) {
                aplicarFiltroBtn.addEventListener('click', function() {
                    periodoSeleccionado = periodoSelector.value;
                    tipoVistaSeleccionado = tipoVistaSelector.value;
                    
                    // Actualizar m√©tricas con el filtro seleccionado
                    actualizarMetricas();
                    
                    // Mostrar notificaci√≥n
                    mostrarNotificacion('Filtro aplicado correctamente');
                });
            }
            
            if (resetFiltroBtn) {
                resetFiltroBtn.addEventListener('click', function() {
                    periodoSelector.value = 'todos';
                    tipoVistaSelector.value = 'acumulado';
                    periodoSeleccionado = 'todos';
                    tipoVistaSeleccionado = 'acumulado';
                    
                    // Actualizar m√©tricas
                    actualizarMetricas();
                    
                    // Mostrar notificaci√≥n
                    mostrarNotificacion('Filtro restablecido');
                });
            }
            
            // Funci√≥n para mostrar notificaciones
            function mostrarNotificacion(mensaje) {
                // Crear elemento de notificaci√≥n
                const notificacion = document.createElement('div');
                notificacion.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #1F7A3E;
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    z-index: 1000;
                    font-weight: 600;
                    animation: slideIn 0.3s ease;
                `;
                notificacion.textContent = mensaje;
                document.body.appendChild(notificacion);
                
                // Remover despu√©s de 3 segundos
                setTimeout(() => {
                    notificacion.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        document.body.removeChild(notificacion);
                    }, 300);
                }, 3000);
            }
            
            // Agregar estilos CSS para animaciones
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        });

        console.log('üìä Dashboard cargado con filtros para ETIMO');
    </script>
            
</body>
</html>